# Проверка корректности фотографии лица (ICAO 9303 Compliance Check)

**ВКР Магистратура ТГУ 2026**  
**Автор:** Большова Е.А.  
**Направление:** Компьютерное зрение и нейронные сети
**Кейс:** Автоматическая проверка корректности фотографии лица при регистрации в Российской государственной библиотеке (РГБ) на соответствие стандартам ICAO 9303 и ISO/IEC 19794-5.

## Описание проекта
Данный сервис предназначен для автоматической оценки качества портретных фотографий. Система проверяет геометрию лица (ракурс) и вычисляет биометрическое качество изображения, что позволяет снизить количество некорректных фото в базе данных библиотеки без излишнего дискомфорта для пользователей.

## Технологический стек
*   **Язык:** Python 3.12
*   **Детекция лица:** MediaPipe Face Mesh (Google)
*   **Оценка качества (FIQA):** MagFace (iResNet50) на **PyTorch**
*   **Инференс:** PyTorch (поддержка CPU и Apple Metal/MPS)
*   **API:** FastAPI (Asynchronous)

## Установка и запуск

1. **Клонирование репозитория:**
```bash
git clone https://github.com/bolshovaelizaveta/tsu-cv-msc-face-compliance.git
cd tsu-cv-msc-face-compliance
```

### 2. Предварительные требования
*   Python 3.9+ (Тестировалось на 3.12)
*   Веб-камера (для демо-режима)
*   macOS (MPS), Linux или Windows

### 3. Установка зависимостей
```bash
# Создание виртуального окружения
python -m venv venv
source venv/bin/activate  # MacOS/Linux
# venv\Scripts\activate   # Windows

# Установка пакетов
pip install -r requirements.txt
```

### 4. Подготовка моделей
1. Скачайте оригинальные веса модели MagFace (`magface_iresnet50_MS1MV2.pth`) из [официального репозитория](https://github.com/IrvingMeng/MagFace).
2. Переместите файл в папку `models/` в корне проекта.
   
*Структура:* `tsu-cv-msc-face-compliance/models/magface_iresnet50_MS1MV2.pth`

### 5. Запуск

**Вариант А: Демонстрация (Веб-камера)**
Визуализация работы алгоритмов в реальном времени с отображением метрик.
```bash
python test_pipeline.py
```

**Вариант Б: API Сервер**
Запуск REST API. После запуска документация Swagger доступна по адресу: http://localhost:8000/docs
```bash
uvicorn main:app --reload
```

## Тестирование и метрики

Для валидации системы использовался контрольный датасет из 10 снимков (`data/test_samples`), включающий как корректные изображения, так и намеренные нарушения (сильные повороты, расфокус, отсутствие лица).

**Результаты тестирования:**
- **Precision:** 1.00
- **Recall:** 1.00
- **F1-Score:** 1.00
- **Avg Latency:** 21.16 ms
- **System FPS:** ~47.3

Примеры тестовых фотографий `data/test_samples` и логи прогона в папке `docs/results_screenshots`.

## Лицензия
MIT License. Проект разработан в образовательных целях.
```