# Задание 1: Постановка задачи и жизненный цикл проекта

**Тема:** Проверка корректности фотографии лица пользователя при регистрации.

## 1. Переформулирование задачи

**Бизнес-задача:**
Автоматизировать процесс модерации фотографий пользователей при онлайн-регистрации в РГБ, исключив загрузку изображений низкого качества, посторонних объектов, групповых снимков или изображений, не позволяющих идентифицировать личность, с предоставлением пользователю обратной связи о причинах отказа.

**ML/CV-задача:**
Разработка каскадного пайплайна (pipeline) обработки изображений, включающего:

1.  **Face Detection:** Локализация лица на изображении.
2.  **Face Image Quality Assessment (FIQA):** Задача классификации/регрессии для оценки технических параметров (резкость, освещенность, наличие артефактов). Генерирует метки качества фото лица на основе Wasserstein Distance между распределением расстояний внутри класса.
3.  **Head Pose Estimation (HPE):** Оценка углов Эйлера (yaw, pitch, roll) для проверки положения головы «анфас».
4.  **Attribute Classification:** Классификация наличия атрибутов (солнцезащитные очки, маски, головные уборы, закрытые глаза).
5.  **Anti-spoofing (Liveness Detection):** Бинарная классификация для отличия живого лица от подделки (экран, бумага) на основе анализа текстур или частотного анализа.

---

## 2. Анализ предметной области

### Контекст
*   **Отрасль:** EdTech / GovTech (Государственные услуги, цифровые библиотеки).
*   **Сценарий:** Пользователь загружает фото через веб-интерфейс (браузер) или мобильное устройство.
*   **Стандарты:** В качестве эталона требований используется международный стандарт **ICAO 9303** (фото на документы), адаптированный под web-условия (менее строгий к фону, но строгий к лицу).

### Ключевые метрики эффективности
1.  **False Rejection Rate (FRR):** Процент отклоненных корректных фотографий. **Цель: < 5%.**
2.  **False Acceptance Rate (FAR):** Процент пропущенных некорректных фото (котики, размытые пятна). **Цель: < 1%.**
3.  **Latency:** Время от загрузки до вердикта. **Цель: < 2-3 сек.**
4.  **Interpretability:** Точность определения причины отказа (например, точность классификатора "очки").

### Обзор существующих решений

| Название / Ссылка | Тип задачи | Методы | Плюсы | Минусы | Лицензия |
| :--- | :--- | :--- | :--- | :--- | :--- |
| **[MediaPipe Face Mesh](https://github.com/google-ai-edge/mediapipe)** (Google) | Детекция + Геометрия | Lightweight CNN, 3D Mesh regression (468 точек) | Работает в браузере, очень быстрый, идеально определяет поворот головы и открытие глаз. | Плохо определяет размытие и шумы. Не предназначен для оценки "валидности" фото (FIQA). | Apache 2.0 |
| **[InsightFace](https://github.com/deepinsight/insightface)** (ArcFace/RetinaFace) | Детекция + Распознавание | ResNet, MobileNet, Angular Margin Loss | Лучшая точность детекции лиц, устойчивость к маскам и сложным условиям. | Тяжеловесный для CPU. Фокус на распознавании ID, а не на качестве. | MIT |
| **[MagFace](https://github.com/IrvingMeng/MagFace)** / FaceQnet | FIQA (Quality Assessment) | Deep Learning (Quality aware loss) | Специализированные решения для оценки пригодности фото для распознавания. | Требуют GPU для обучения. Узкая специализация (только качество). | Non-commercial / MIT |
| **[Silent-Face-Anti-Spoofing](https://github.com/minivision-ai/Silent-Face-Anti-Spoofing)** | Anti-Spoofing | Fourier Spectrum Analysis | Определяет подделки (экран/бумага) через анализ Фурье-спектра (муар). | Чувствителен к освещению и сжатию (артефакты JPEG могут считаться атакой). Требует строгого кропа. | Apache 2.0 |

> **Вывод по обзору существующих решений:**
> В ходе анализа были рассмотрены решения класса FIQA. Классические детекторы (HAAR Cascades) устарели. Современные подходы делятся на геометрические (MediaPipe) и репрезентативные (MagFace).
> Для задачи дипломной работы наиболее подходящий **гибридный подход**: использование **MediaPipe** для быстрых геометрических проверок и **MagFace** (или аналогов на MobileNet) для оценки технического качества.

### Стейкхолдеры
*   **Заказчик (РГБ):** Администрация (цель: чистая база данных).
*   **Пользователи:** Читатели (цель: быстрая регистрация без непонятных ошибок).

---

## 3. Ограничения

1.  **Данные:** Отсутствие размеченного датасета.
    *   *Решение:* Использование открытых датасетов (FFHQ, CelebA) + синтетическая генерация дефектов + ручной сбор.
2.  **Юридические (GDPR / 152-ФЗ):**
    *   Работа с биометрией. Система не должна сохранять лица навсегда, обработка сразу. В рамках ВКР можно ограничиться использованием синтетических данных.
3.  **Вычислительные:**
    *   Инференс должен работать на **CPU** (ограниченный бюджет заказчика, разработка кейса производится на macOS). Это исключает тяжелые трансформеры.
4.  **Технические:**
    *   Разнообразие источников: веб-камеры низкого разрешения, сканы паспортов (проблема с бликами и anti-spoofing).

---

## 4. Критерии успеха

**Количественные:**
*   **Точность детекции лица (Recall):** ≥ 0.99.
*   **Точность классификации дефектов (F1-score):** ≥ 0.85 (для классов: очки, поворот, темнота).
*   **Скорость:** < 1.5 сек на изображение (CPU).

**Качественные:**
*   Система возвращает список конкретных ошибок: `["low_light", "glasses_detected"]`, а не просто `False`.
*   Устойчивость к явным дипфейкам (кот, знаменитость) — опционально.

---

## 5. Границы проекта

**Входит в границы проекта:**
1.  Детекция наличия одного лица в кадре.
2.  Оценка геометрических параметров: поворот головы, открытость глаз.
3.  Оценка технического качества: размытие (Laplacian/CNN), освещенность.
4.  Детекция атрибутов: очки, маски.
5.  Генерация текстового ответа с причиной отказа.

**Не входит в границы проекта:**
1.  **Face Verification / Identification:** Сверка личности с документами (технически сложно без доступа к базе МВД/Паспортов).
2.  **Сложный Anti-spoofing:** Защита от 3D-масок и дипфейков высокого уровня.
3.  **Распознавание эмоций:** Не требуется по ТЗ.